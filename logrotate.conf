# SMTP 隧道代理日志轮转配置
# 安装位置: /opt/smtp-tunnel/logs/logrotate.conf

/opt/smtp-tunnel/logs/*.log {
    # 每天轮转一次
    daily

    # 保留最近30天的日志
    rotate 30

    # 如果日志文件为空则不轮转
    notifempty

    # 轮转后创建新日志文件
    create 0644 root root

    # 压缩旧日志文件
    compress

    # 延迟压缩（下次轮转时才压缩）
    delaycompress

    # 保留最近7天的未压缩日志
    rotate 7

    # 日志文件大小超过100MB时立即轮转
    size 100M

    # 缺失日志文件时不报错
    missingok

    # 轮转前发送信号通知应用程序重新打开日志文件
    # 对于Python程序，需要实现信号处理
    # postrotate
    #     systemctl reload smtp-tunnel > /dev/null 2>&1 || true
    # endscript

    # 轮转后的日志文件名格式
    # smtp-tunnel.log -> smtp-tunnel.log.1 -> smtp-tunnel.log.2.gz
}
