# SMTP 隧道代理 - 本地化安装手册

## 目录

- [项目概述](#项目概述)
- [系统要求](#系统要求)
- [快速开始](#快速开始)
- [服务器部署](#服务器部署)
- [客户端部署](#客户端部署)
- [配置说明](#配置说明)
- [用户管理](#用户管理)
- [服务管理](#服务管理)
- [故障排除](#故障排除)
- [安全建议](#安全建议)

---

## 项目概述

SMTP 隧道代理是一种高速隐蔽隧道，将 TCP 流量伪装成 SMTP 电子邮件通信，以绕过深度包检测（DPI）防火墙。

### 核心特性

- **TLS 加密**：STARTTLS 后所有流量使用 TLS 1.2+ 加密
- **DPI 规避**：初始握手模仿真实 SMTP 服务器（Postfix）
- **高速传输**：握手后使用二进制流式协议，最小开销
- **多用户支持**：每用户独立密钥、IP 白名单和日志设置
- **身份验证**：每用户使用 HMAC-SHA256 预共享密钥
- **SOCKS5 代理**：标准代理接口，适用于任何应用程序
- **多路复用**：单个隧道支持多个连接
- **IP 白名单**：按用户通过 IP 地址/CIDR 进行访问控制
- **自动重连**：客户端在连接断开时自动重连

### 工作原理

```
应用程序 → SOCKS5代理(1080) → 客户端 → SMTP隧道(587) → 服务器 → 互联网
```

---

## 系统要求

### 服务器端

- **操作系统**：Linux（推荐 Ubuntu 20.04+, Debian 10+, CentOS 8+, Fedora 33+, Arch Linux）
- **Python 版本**：Python 3.8 或更高版本
- **内存**：至少 512MB RAM
- **磁盘空间**：至少 100MB 可用空间
- **网络**：
  - 公网 IP 地址
  - 端口 587（SMTP 提交端口）对外开放
  - 域名（推荐使用，用于 TLS 证书验证）

### 客户端

- **操作系统**：Windows、macOS 或 Linux
- **Python 版本**：Python 3.8 或更高版本
- **网络**：能够连接到服务器的网络环境

### 依赖包

服务器和客户端都需要以下 Python 包：

```
cryptography>=41.0.0
pyyaml>=6.0
```

---

## 快速开始

### 一键安装（推荐）

在服务器上运行以下命令：

```bash
curl -sSL https://raw.githubusercontent.com/purpose168/smtp-tunnel-proxy/main/install.sh | sudo bash
```

安装程序将自动：
1. 安装所有系统依赖
2. 下载并配置应用程序
3. 生成 TLS 证书
4. 配置防火墙
5. 启动服务

### 手动安装

如果您需要更多控制，可以按照以下步骤手动安装：

1. **克隆或下载项目文件**
2. **安装系统依赖**
3. **配置服务器**
4. **生成 TLS 证书**
5. **启动服务**

详细步骤请参考 [服务器部署](#服务器部署) 章节。

---

## 服务器部署

### 步骤 1：准备环境

#### 1.1 更新系统

```bash
# Ubuntu/Debian
sudo apt update && sudo apt upgrade -y

# CentOS/RHEL
sudo yum update -y

# Fedora
sudo dnf upgrade -y

# Arch Linux
sudo pacman -Syu --noconfirm
```

#### 1.2 安装 Python 和依赖

**Ubuntu/Debian:**
```bash
sudo apt install -y python3 python3-pip python3-venv curl
```

**CentOS/RHEL/Rocky/Alma:**
```bash
sudo yum install -y python3 python3-pip curl
# 或
sudo dnf install -y python3 python3-pip curl
```

**Fedora:**
```bash
sudo dnf install -y python3 python3-pip curl
```

**Arch Linux:**
```bash
sudo pacman -Sy --noconfirm python python-pip curl
```

#### 1.3 验证 Python 版本

```bash
python3 --version
# 应该输出 Python 3.8 或更高版本
```

### 步骤 2：获取域名

获取一个指向您服务器 IP 的域名。以下是免费选项：

- **DuckDNS** (https://www.duckdns.org) - 推荐，简单且免费
- **No-IP** (https://www.noip.com) - 提供免费套餐
- **FreeDNS** (https://freedns.afraid.org) - 多种域名选项

示例：`myserver.duckdns.org` → `203.0.113.50`（您的服务器 IP）

### 步骤 3：下载项目文件

#### 3.1 创建安装目录

```bash
sudo mkdir -p /opt/smtp-tunnel
sudo mkdir -p /etc/smtp-tunnel
```

#### 3.2 下载项目文件

**选项 A：从 GitHub 克隆**

```bash
cd /tmp
git clone https://github.com/purpose168/smtp-tunnel-proxy.git
cd smtp-tunnel-proxy
```

**选项 B：直接下载文件**

```bash
cd /opt/smtp-tunnel

# 下载 Python 文件
sudo curl -O https://raw.githubusercontent.com/purpose168/smtp-tunnel-proxy/main/server.py
sudo curl -O https://raw.githubusercontent.com/purpose168/smtp-tunnel-proxy/main/client.py
sudo curl -O https://raw.githubusercontent.com/purpose168/smtp-tunnel-proxy/main/common.py
sudo curl -O https://raw.githubusercontent.com/purpose168/smtp-tunnel-proxy/main/generate_certs.py
sudo curl -O https://raw.githubusercontent.com/purpose168/smtp-tunnel-proxy/main/requirements.txt

# 下载管理脚本
sudo curl -O https://raw.githubusercontent.com/purpose168/smtp-tunnel-proxy/main/smtp-tunnel-adduser
sudo curl -O https://raw.githubusercontent.com/purpose168/smtp-tunnel-proxy/main/smtp-tunnel-deluser
sudo curl -O https://raw.githubusercontent.com/purpose168/smtp-tunnel-proxy/main/smtp-tunnel-listusers
sudo curl -O https://raw.githubusercontent.com/purpose168/smtp-tunnel-proxy/main/smtp-tunnel-update

# 设置执行权限
sudo chmod +x /opt/smtp-tunnel/smtp-tunnel-*
```

#### 3.3 创建符号链接

```bash
sudo ln -sf /opt/smtp-tunnel/smtp-tunnel-adduser /usr/local/bin/smtp-tunnel-adduser
sudo ln -sf /opt/smtp-tunnel/smtp-tunnel-deluser /usr/local/bin/smtp-tunnel-deluser
sudo ln -sf /opt/smtp-tunnel/smtp-tunnel-listusers /usr/local/bin/smtp-tunnel-listusers
sudo ln -sf /opt/smtp-tunnel/smtp-tunnel-update /usr/local/bin/smtp-tunnel-update
```

### 步骤 4：安装 Python 依赖

```bash
cd /opt/smtp-tunnel
sudo pip3 install -r requirements.txt
```

### 步骤 5：配置服务器

#### 5.1 创建配置文件

```bash
sudo nano /etc/smtp-tunnel/config.yaml
```

添加以下内容（替换 `mail.example.com` 为您的域名）：

```yaml
server:
  host: "0.0.0.0"
  port: 587
  hostname: "mail.example.com"
  cert_file: "/etc/smtp-tunnel/server.crt"
  key_file: "/etc/smtp-tunnel/server.key"
  users_file: "/etc/smtp-tunnel/users.yaml"
  log_users: true

client:
  server_host: "mail.example.com"
  server_port: 587
  socks_port: 1080
  socks_host: "127.0.0.1"
  ca_cert: "ca.crt"
```

保存并退出（Ctrl+O, Enter, Ctrl+X）。

#### 5.2 设置文件权限

```bash
sudo chmod 600 /etc/smtp-tunnel/config.yaml
```

### 步骤 6：生成 TLS 证书

```bash
cd /opt/smtp-tunnel
sudo python3 generate_certs.py --hostname mail.example.com --output-dir /etc/smtp-tunnel
```

将 `mail.example.com` 替换为您的实际域名。

### 步骤 7：创建用户配置文件

```bash
sudo nano /etc/smtp-tunnel/users.yaml
```

添加以下内容：

```yaml
users: {}
```

保存并退出。

```bash
sudo chmod 600 /etc/smtp-tunnel/users.yaml
```

### 步骤 8：配置防火墙

#### UFW (Ubuntu/Debian)

```bash
sudo ufw allow 587/tcp
sudo ufw reload
```

#### firewalld (CentOS/RHEL/Fedora)

```bash
sudo firewall-cmd --permanent --add-port=587/tcp
sudo firewall-cmd --reload
```

#### iptables (通用)

```bash
sudo iptables -A INPUT -p tcp --dport 587 -j ACCEPT
sudo iptables-save | sudo tee /etc/iptables/rules.v4
```

### 步骤 9：创建 systemd 服务

```bash
sudo nano /etc/systemd/system/smtp-tunnel.service
```

添加以下内容：

```ini
[Unit]
Description=SMTP 隧道服务器
Documentation=https://github.com/purpose168/smtp-tunnel-proxy
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/smtp-tunnel
ExecStart=/usr/bin/python3 /opt/smtp-tunnel/server.py -c /etc/smtp-tunnel/config.yaml
Restart=on-failure
RestartSec=5
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

保存并退出。

### 步骤 10：启动服务

```bash
# 重载 systemd 配置
sudo systemctl daemon-reload

# 启用服务（开机自启）
sudo systemctl enable smtp-tunnel

# 启动服务
sudo systemctl start smtp-tunnel

# 检查服务状态
sudo systemctl status smtp-tunnel
```

如果服务正在运行，您应该看到类似以下的输出：

```
● smtp-tunnel.service - SMTP 隧道服务器
     Loaded: loaded (/etc/systemd/system/smtp-tunnel.service; enabled; vendor preset: enabled)
     Active: active (running) since Mon 2024-01-10 10:00:00 UTC; 5s ago
   Main PID: 12345 (python3)
      Tasks: 1 (limit: 4915)
     Memory: 15.2M
        CPU: 123ms
     CGroup: /system.slice/smtp-tunnel.service
             └─12345 /usr/bin/python3 /opt/smtp-tunnel/server.py -c /etc/smtp-tunnel/config.yaml
```

### 步骤 11：验证服务

```bash
# 查看服务日志
sudo journalctl -u smtp-tunnel -n 50 -f

# 在另一个终端测试端口
netstat -tlnp | grep 587
# 或
ss -tlnp | grep 587
```

您应该看到端口 587 正在监听。

---

## 客户端部署

### 方式一：使用生成的客户端包（推荐）

#### 1. 添加用户并生成客户端包

在服务器上运行：

```bash
smtp-tunnel-adduser alice
```

这将：
- 创建用户 `alice`
- 生成随机密钥
- 创建客户端配置文件
- 打包成 ZIP 文件

输出示例：

```
[INFO] 正在创建用户 'alice'...
[INFO] 已生成密钥
[INFO] 已创建客户端配置
[INFO] 已创建客户端包: /opt/smtp-tunnel/alice.zip
[INFO] 完成！
```

#### 2. 下载客户端包

```bash
# 使用 scp 从服务器下载
scp root@your-server.com:/opt/smtp-tunnel/alice.zip .

# 或使用 sftp
sftp root@your-server.com
get /opt/smtp-tunnel/alice.zip
```

#### 3. 解压客户端包

**Windows:**
- 右键点击 `alice.zip`
- 选择"解压到当前文件夹"

**Linux/macOS:**
```bash
unzip alice.zip
cd alice
```

解压后的文件结构：

```
alice/
├── client.py          # 客户端程序
├── config.yaml        # 客户端配置
├── ca.crt            # CA 证书
├── requirements.txt  # Python 依赖
├── start.sh          # Linux/macOS 启动脚本
└── start.bat         # Windows 启动脚本
```

#### 4. 运行客户端

**Windows:**
- 双击 `start.bat`

**Linux/macOS:**
```bash
chmod +x start.sh
./start.sh
```

启动脚本会自动：
- 检查 Python 版本
- 安装依赖
- 启动客户端

#### 5. 验证连接

如果连接成功，您应该看到：

```
SMTP Tunnel Proxy Client
User: alice

[INFO] Starting SMTP Tunnel...
[INFO] SOCKS5 proxy will be available at 127.0.0.1:1080

Connecting to mail.example.com:587
Connected - binary mode active
SOCKS5 proxy on 127.0.0.1:1080
```

### 方式二：手动配置

#### 1. 安装 Python 依赖

```bash
pip install -r requirements.txt
```

#### 2. 创建配置文件

```bash
nano config.yaml
```

添加以下内容：

```yaml
client:
  server_host: "mail.example.com"
  server_port: 587
  socks_port: 1080
  socks_host: "127.0.0.1"
  username: "alice"
  secret: "your-secret-from-server"
  ca_cert: "ca.crt"
```

#### 3. 获取 CA 证书

从服务器下载 CA 证书：

```bash
scp root@your-server.com:/etc/smtp-tunnel/ca.crt .
```

#### 4. 运行客户端

```bash
python client.py
```

或使用配置文件：

```bash
python client.py -c config.yaml
```

### 方式三：命令行参数

```bash
python client.py \
  --server mail.example.com \
  --server-port 587 \
  -p 1080 \
  -u alice \
  -s your-secret \
  --ca-cert ca.crt
```

---

## 配置说明

### 服务器配置 (config.yaml)

```yaml
server:
  # 监听地址（0.0.0.0 表示所有网络接口）
  host: "0.0.0.0"

  # SMTP 提交端口（587 是标准端口）
  port: 587

  # SMTP 主机名（必须与证书匹配）
  hostname: "mail.example.com"

  # TLS 证书和密钥文件
  cert_file: "/etc/smtp-tunnel/server.crt"
  key_file: "/etc/smtp-tunnel/server.key"

  # 用户配置文件
  users_file: "/etc/smtp-tunnel/users.yaml"

  # 全局日志设置
  log_users: true
```

### 用户配置 (users.yaml)

```yaml
users:
  alice:
    secret: "auto-generated-secret"
    whitelist:
      - "192.168.1.100"
      - "10.0.0.0/8"
    logging: true

  bob:
    secret: "another-secret"
    whitelist:
      - "203.0.113.50"
    logging: false
```

**配置说明：**

- `secret`: 用户的身份验证密钥（必需）
- `whitelist`: 允许的 IP 地址列表（可选，支持 CIDR）
- `logging`: 是否记录此用户的活动（可选，默认 true）

### 客户端配置 (config.yaml)

```yaml
client:
  # 服务器连接配置
  server_host: "mail.example.com"
  server_port: 587

  # 身份验证配置
  username: "alice"
  secret: "your-secret"

  # 本地 SOCKS5 代理配置
  socks_port: 1080
  socks_host: "127.0.0.1"

  # CA 证书
  ca_cert: "ca.crt"
```

---

## 用户管理

### 添加用户

```bash
smtp-tunnel-adduser <username>
```

**示例：**

```bash
smtp-tunnel-adduser bob
```

**选项：**

- `-u, --users-file`: 指定用户配置文件路径
- `-c, --config`: 指定服务器配置文件路径
- `--no-zip`: 不生成客户端 ZIP 包

### 删除用户

```bash
smtp-tunnel-deluser <username>
```

**示例：**

```bash
smtp-tunnel-deluser bob
```

**选项：**

- `-u, --users-file`: 指定用户配置文件路径
- `-f`: 跳过确认提示

### 列出用户

```bash
smtp-tunnel-listusers
```

**选项：**

- `-u, --users-file`: 指定用户配置文件路径
- `-v, --verbose`: 显示详细信息（包括密钥和白名单）

**示例：**

```bash
# 简单列表
smtp-tunnel-listusers

# 详细列表
smtp-tunnel-listusers -v
```

### 更新用户

编辑用户配置文件：

```bash
sudo nano /etc/smtp-tunnel/users.yaml
```

修改后无需重启服务，更改会自动生效。

---

## 服务管理

### 查看服务状态

```bash
sudo systemctl status smtp-tunnel
```

### 启动服务

```bash
sudo systemctl start smtp-tunnel
```

### 停止服务

```bash
sudo systemctl stop smtp-tunnel
```

### 重启服务

```bash
sudo systemctl restart smtp-tunnel
```

### 重新加载配置

```bash
sudo systemctl reload smtp-tunnel
```

### 查看日志

```bash
# 实时查看日志
sudo journalctl -u smtp-tunnel -f

# 查看最近 100 行日志
sudo journalctl -u smtp-tunnel -n 100

# 查看今天的日志
sudo journalctl -u smtp-tunnel --since today

# 查看带时间戳的日志
sudo journalctl -u smtp-tunnel -o verbose
```

### 启用/禁用开机自启

```bash
# 启用开机自启
sudo systemctl enable smtp-tunnel

# 禁用开机自启
sudo systemctl disable smtp-tunnel
```

### 更新服务器

```bash
smtp-tunnel-update
```

这将：
- 更新代码到最新版本
- 保留配置、证书和用户
- 重启服务

### 卸载

```bash
sudo /opt/smtp-tunnel/uninstall.sh
```

注意：配置文件 `/etc/smtp-tunnel` 不会被删除。如需删除，请手动执行：

```bash
sudo rm -rf /etc/smtp-tunnel
```

---

## 故障排除

### 问题 1：端口被占用

**症状：**
```
[ERROR] Failed to bind to 0.0.0.0:587: [Errno 98] Address already in use
```

**解决方案：**

1. 检查端口占用情况：

```bash
sudo netstat -tlnp | grep 587
# 或
sudo ss -tlnp | grep 587
```

2. 找到占用端口的进程 ID (PID)

3. 终止占用端口的进程：

```bash
sudo kill <PID>
# 或强制终止
sudo kill -9 <PID>
```

4. 重新启动服务：

```bash
sudo systemctl restart smtp-tunnel
```

### 问题 2：连接被拒绝

**症状：**
```
[ERROR] Connection refused
```

**解决方案：**

1. 检查服务是否正在运行：

```bash
sudo systemctl status smtp-tunnel
```

2. 如果服务未运行，启动服务：

```bash
sudo systemctl start smtp-tunnel
```

3. 检查端口是否开放：

```bash
sudo netstat -tlnp | grep 587
```

4. 检查防火墙设置：

```bash
# UFW
sudo ufw status

# firewalld
sudo firewall-cmd --list-ports

# iptables
sudo iptables -L -n | grep 587
```

5. 如果需要，开放端口：

```bash
# UFW
sudo ufw allow 587/tcp

# firewalld
sudo firewall-cmd --permanent --add-port=587/tcp
sudo firewall-cmd --reload
```

### 问题 3：身份验证失败

**症状：**
```
[ERROR] Auth failed
```

**解决方案：**

1. 验证用户名和密钥：

```bash
smtp-tunnel-listusers -v
```

2. 检查客户端配置文件中的 `username` 和 `secret` 是否正确

3. 确保服务器时间准确（时间差不应超过 5 分钟）：

```bash
# 检查服务器时间
date

# 同步时间（Ubuntu/Debian）
sudo ntpdate pool.ntp.org

# 同步时间（CentOS/RHEL）
sudo chrony sources
```

### 问题 4：IP 不在白名单中

**症状：**
```
[ERROR] IP not whitelisted
```

**解决方案：**

1. 查看用户配置：

```bash
sudo cat /etc/smtp-tunnel/users.yaml
```

2. 检查白名单设置

3. 添加您的 IP 地址到白名单：

```bash
sudo nano /etc/smtp-tunnel/users.yaml
```

修改白名单：

```yaml
users:
  alice:
    secret: "your-secret"
    whitelist:
      - "your-ip-address"
      - "your-network/24"
```

4. 保存并退出，无需重启服务

### 问题 5：证书验证失败

**症状：**
```
[ERROR] Certificate verify failed
```

**解决方案：**

1. 确保使用域名而不是 IP 地址连接

2. 验证服务器主机名与证书匹配：

```bash
openssl x509 -in /etc/smtp-tunnel/server.crt -noout -subject
```

3. 确保客户端拥有正确的 CA 证书

4. 重新生成证书（如果需要）：

```bash
cd /opt/smtp-tunnel
sudo python3 generate_certs.py --hostname your-domain.com --output-dir /etc/smtp-tunnel
sudo systemctl restart smtp-tunnel
```

### 问题 6：服务启动失败

**症状：**
```
[ERROR] Failed to start smtp-tunnel.service
```

**解决方案：**

1. 查看详细错误信息：

```bash
sudo journalctl -u smtp-tunnel -n 50
```

2. 检查配置文件语法：

```bash
python3 -c "import yaml; yaml.safe_load(open('/etc/smtp-tunnel/config.yaml'))"
```

3. 检查文件权限：

```bash
ls -la /etc/smtp-tunnel/
```

确保配置文件权限为 600：

```bash
sudo chmod 600 /etc/smtp-tunnel/config.yaml
sudo chmod 600 /etc/smtp-tunnel/users.yaml
```

4. 手动运行服务器以查看错误：

```bash
cd /opt/smtp-tunnel
sudo python3 server.py -c /etc/smtp-tunnel/config.yaml
```

### 问题 7：连接速度慢

**症状：**
连接建立或数据传输速度慢

**解决方案：**

1. 检查网络延迟：

```bash
ping your-server.com
```

2. 检查服务器负载：

```bash
top
# 或
htop
```

3. 检查带宽使用情况：

```bash
iftop
# 或
nload
```

4. 考虑使用更近的服务器位置

### 调试模式

启用详细日志记录以诊断问题：

**服务器端：**

```bash
# 编辑服务文件
sudo nano /etc/systemd/system/smtp-tunnel.service
```

修改 `ExecStart` 行：

```ini
ExecStart=/usr/bin/python3 /opt/smtp-tunnel/server.py -c /etc/smtp-tunnel/config.yaml -d
```

重新加载并重启：

```bash
sudo systemctl daemon-reload
sudo systemctl restart smtp-tunnel
```

**客户端：**

```bash
python client.py -d
```

---

## 安全建议

### 1. 使用域名而非 IP 地址

始终使用域名进行连接，以确保正确的 TLS 证书验证。

### 2. 使用 CA 证书

客户端始终使用 `ca_cert` 参数以防止中间人攻击。

### 3. 保护配置文件

确保配置文件权限正确：

```bash
sudo chmod 600 /etc/smtp-tunnel/config.yaml
sudo chmod 600 /etc/smtp-tunnel/users.yaml
sudo chmod 600 /etc/smtp-tunnel/server.key
```

### 4. 使用强密钥

使用 `smtp-tunnel-adduser` 自动生成强密钥，不要使用弱密钥。

### 5. 启用 IP 白名单

如果知道客户端 IP 地址，使用 IP 白名单限制访问：

```yaml
users:
  alice:
    secret: "your-secret"
    whitelist:
      - "192.168.1.100"
      - "10.0.0.0/8"
```

### 6. 禁用敏感用户的日志记录

对于敏感用户，禁用日志记录：

```yaml
users:
  sensitive-user:
    secret: "your-secret"
    logging: false
```

### 7. 定期更新

定期更新服务器到最新版本：

```bash
smtp-tunnel-update
```

### 8. 监控日志

定期检查服务日志以发现异常活动：

```bash
sudo journalctl -u smtp-tunnel --since yesterday
```

### 9. 使用防火墙

确保只有必要的端口对外开放：

```bash
# 只开放 587 端口
sudo ufw allow 587/tcp
sudo ufw enable
```

### 10. 备份配置

定期备份配置文件和证书：

```bash
sudo tar -czf smtp-tunnel-backup-$(date +%Y%m%d).tar.gz /etc/smtp-tunnel
```

---

## 附录

### A. 端口说明

| 端口 | 协议 | 用途 |
|------|------|------|
| 587 | TCP | SMTP 提交端口（标准） |
| 1080 | TCP | SOCKS5 代理端口（客户端本地） |

### B. 文件位置

| 文件 | 位置 | 说明 |
|------|------|------|
| 服务器程序 | `/opt/smtp-tunnel/server.py` | 服务器主程序 |
| 客户端程序 | `/opt/smtp-tunnel/client.py` | 客户端主程序 |
| 配置文件 | `/etc/smtp-tunnel/config.yaml` | 服务器配置 |
| 用户文件 | `/etc/smtp-tunnel/users.yaml` | 用户配置 |
| 服务器证书 | `/etc/smtp-tunnel/server.crt` | TLS 证书 |
| 服务器密钥 | `/etc/smtp-tunnel/server.key` | TLS 私钥 |
| CA 证书 | `/etc/smtp-tunnel/ca.crt` | CA 证书 |
| 服务文件 | `/etc/systemd/system/smtp-tunnel.service` | systemd 服务 |
| 管理脚本 | `/usr/local/bin/smtp-tunnel-*` | 用户管理脚本 |

### C. 常用命令速查

```bash
# 服务管理
sudo systemctl start smtp-tunnel
sudo systemctl stop smtp-tunnel
sudo systemctl restart smtp-tunnel
sudo systemctl status smtp-tunnel

# 日志查看
sudo journalctl -u smtp-tunnel -f
sudo journalctl -u smtp-tunnel -n 100

# 用户管理
smtp-tunnel-adduser <username>
smtp-tunnel-deluser <username>
smtp-tunnel-listusers -v

# 更新和卸载
smtp-tunnel-update
sudo /opt/smtp-tunnel/uninstall.sh

# 调试
sudo python3 /opt/smtp-tunnel/server.py -c /etc/smtp-tunnel/config.yaml -d
python client.py -d
```

### D. 支持的平台

**服务器：**
- Ubuntu 20.04+
- Debian 10+
- CentOS 8+
- RHEL 8+
- Rocky Linux 8+
- AlmaLinux 8+
- Fedora 33+
- Arch Linux

**客户端：**
- Windows 10/11
- macOS 10.15+
- Linux（主流发行版）

### E. 技术支持

- GitHub Issues: https://github.com/purpose168/smtp-tunnel-proxy/issues
- 技术文档: [TECHNICAL.md](TECHNICAL.md)

---

## 更新日志

**版本 1.3.0**
- 添加多用户支持
- 添加 IP 白名单功能
- 改进错误处理
- 优化性能

---

## 许可证

本项目仅供教育和授权使用。请负责任地使用，并遵守适用法律。

---

## 免责声明

本工具旨在用于合法的隐私和审查规避目的。用户有责任确保其使用符合适用的法律法规。

---

*文档生成时间: 2026-01-10*
